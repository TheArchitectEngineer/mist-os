# Copyright 2022 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

workspace(name = "sdk-integration")

load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")
load("@fuchsia_build_config//:defs.bzl", "build_config")

# Register an empty C++ host toolchain, because thiss test suite
# needs to run on CI bots without GCC or Clang installed.
load(
    "@rules_fuchsia//common:toolchains/clang/repository_utils.bzl",
    "empty_host_cpp_toolchain_repository",
)
load(
    "@rules_fuchsia//fuchsia:deps.bzl",
    "fuchsia_sdk_repository",
)

# Location of Fuchsia source directory, relative to this workspace.
fuchsia_source_dir = "../../.."

empty_host_cpp_toolchain_repository(
    name = "host_no_cpp",
)

register_toolchains("@host_no_cpp//:empty_cpp_toolchain")

fuchsia_sdk_repository(
    name = "fuchsia_sdk_x64_only",
    local_paths = [
        "sdk_generation/goldens/simple_idk_x64",
    ],
)

fuchsia_sdk_repository(
    name = "fuchsia_sdk_arm64_only",
    local_paths = [
        "sdk_generation/goldens/simple_idk_arm64",
    ],
)

fuchsia_sdk_repository(
    name = "fuchsia_sdk_both",
    local_paths = [
        "sdk_generation/goldens/simple_idk_both",
    ],
)

# The @fuchsia_in_tree_idk repository is ignored, except when running the
# test suite for the Fuchsia platform build. In this case it will
# be overridden explicitly on the command-line with
# `--override-repository=fuchsia_in_tree_idk=<realpath>`, but a
# declaration must appear in this file for it.
new_local_repository(
    name = "fuchsia_in_tree_idk",
    build_file_content = "",
    path = "scripts",
    repo_mapping = {},
)

local_repository(
    name = "fuchsia-infra-bazel-rules",
    path = "%s/third_party/fuchsia-infra-bazel-rules/src" % fuchsia_source_dir,
)

new_local_repository(
    name = "bazel",
    build_file_content = """
# Copyright 2024 The Fuchsia Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

filegroup(
    name = "all_files",
    srcs = glob(["**/*"]),
    visibility = ["//visibility:public"],
)
""",
    path = "%s/prebuilt/third_party/bazel/%s" % (
        fuchsia_source_dir,
        build_config.host_tag,
    ),
)
